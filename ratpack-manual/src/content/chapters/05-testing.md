# Testing Ratpack Applications

Ratpack applications should be easy to test. In this chapter, you will learn about the many convenience methods and utilities available as part of Ratpack's testing support.

## Spock Integration

Spock is a testing and specification framework for Java and Groovy applications. If you are unfamiliar with Spock, please read refer to the [Spock Framework Reference](https://spock-framework.readthedocs.org/en/latest/) for more information.

Support for running Spock tests is provided via the ratpack-groovy plugin for Gradle.

In your build.gradle file, you can include the gradle plugin as follows:

```

include plugin 'ratpack-groovy'
```

The ratpack-groovy plugin is included in the template generated by Lazybones.

Once you have included the ratpack plugin, you can run your tests via:

```
./gradlew test
```

## Unit Testing Ratpack Handlers with invoke()

The invoke() mechanism within Ratpack allows you to unit test [`Handlers`](api/org/ratpackframework/handling/Handler.html) without starting up a Ratpack server. 

Let's assume we have a Handler that looks like the following:

```
class MyHandler implements Handler {
  void handle(Context context) {
    context.with {
      response.headers.set("set-header", "set")
      response.send request.headers.get("test-header") + ":" + request.uri
    }
  }
}
```

If we ran this Handler, we would expect:

* Headers: 'set-header' with the value of set.
* Body: The value of the 'test-header' header. Followed by a ':'. Followed by the requesting path.

The specification for this handler will look like this:

```
package org.ratpackframework.test.handling

import spock.lang.Specification
import static org.ratpackframework.groovy.test.handling.InvocationBuilder.invoke

class MyHandlerSpec extends Specification {

  def "should set a header and return the uri path in the body"() {
    when: "call invoke on MyHandler"
    def invocation = invoke(new MyHandler()) {
      requestHeaders.set("Test-Header", "foo")
      uri = "/bar"
    }

    then: "expect the correct headers and body text to be returned"
    invocation.getHeaders().get("set-header") == "set"
    invocation.getBodyText() == "foo:/bar"
  }
}
```

1. First, we import the invoke method from the [`InvocationBuilder`](api/org/ratpackframework/groovy/test/handling/InvocationBuilder.html) so that we can unit test our Handler

```
import static org.ratpackframework.groovy.test.handling.InvocationBuilder.invoke
```

2. The invoke method in our when block takes in an instance of the handler under test, followed by the invocation being built, which is a DSL. 

3. Invoke returns a [`Invocation`](api/org/ratpackframework/groovy/test/handling/InvocationBuilder.html), which has a series of convenience methods to check the results of the 

If you want a full example, Rob Fletcher's Mid Century Ipsum project contains of a fully implemented [Handler](https://github.com/robfletcher/midcentury-ipsum/blob/master/src/main/groovy/com/energizedwork/midcenturyipsum/IpsumHandler.groovy) and associated [test](https://github.com/robfletcher/midcentury-ipsum/blob/master/src/test/groovy/com/energizedwork/midcenturyipsum/IpsumHandlerSpec.groovy).

### Building Invocations

### Checking Invocation Results

#### isSentResponse()

#### isCalledNext()

#### getBodyText()

#### getBodyBytes()

#### getException()

#### getHeaders()

#### getSentFile()

#### getStatus()

### Testing Template Rendering - rendered(Class<T> type)

